# Home Assistant Add-on: FRPC Client

通过 LinknLink 平台，让您轻松实现 Home Assistant 的远程访问。

## 开始使用

### 准备工作

在使用本 Add-on 之前，您需要：

1. 拥有一个 LinknLink 平台账号（邮箱和密码）
2. 确保 Home Assistant 正常运行
3. 确保网络连接正常

> **提示**
> 
> 如果您还没有 LinknLink 账号，请使用LinknLink APP注册开通。

### 启用侧边栏显示（可选）

为了方便访问和管理，您可以将 Add-on 显示在侧边栏：

1. 进入 `设置` → `加载项` → `FRPC Client`
2. 开启 **在侧边栏中显示** 选项

## 配置

### 基本配置

本 Add-on 的配置非常简单，只需要提供 LinknLink 平台的登录凭据。

#### 必需参数

在 Add-on 配置页面中，您需要填写以下信息：

- **email**: 您的 LinknLink 平台账号邮箱
- **password**: 您的 LinknLink 平台账号密码

### 配置示例

#### 基本示例

```yaml
authentication:
  email: "your-email@example.com"
  password: "your-password"
```

> **注意**
> 
> 密码字段在配置界面中会以密文形式显示，保护您的隐私安全。

## 工作原理

FRPC Client Add-on 的工作流程：

1. **设备识别**: 启动时自动获取设备唯一标识
2. **平台登录**: 使用您提供的账号密码登录 LinknLink 平台
3. **代理注册**: 自动向平台注册 Home Assistant 服务（端口 8123）
4. **建立连接**: 下载并启动 FRPC 客户端，建立反向代理隧道（端口38123）
5. **保持在线**: 持续维护连接，确保远程访问稳定可用

### 设备 ID

每个设备都有一个唯一的 32 位设备 ID，用于在平台上标识您的 Home Assistant 实例。

设备 ID 生成规则：
- 优先使用网络接口 MAC 地址（补齐至 32 位）
- 如果 MAC 地址不可用，则使用 UUID
- 作为最后手段，使用时间戳生成唯一 ID

您可以在以下位置查看设备 ID：

1. **日志输出**: 启动时会醒目显示
   ```
   ==========================================
     设备ID (Device ID): xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ==========================================
   ```

## 代理配置

### 默认代理规则

Add-on 会自动配置以下代理规则：

| 服务名称 | 本地端口 | 远程端口 | 说明 |
|---------|---------|---------|------|
| HomeAssistant | 8123 | 38123 | Home Assistant Web 界面 |

### 网络模式

本 Add-on 使用 **Host 网络模式**，这意味着：

- Add-on 容器直接使用宿主机的网络
- 可以直接访问 `127.0.0.1:8123` 的 Home Assistant 服务
- 无需额外的网络配置或端口映射

## 日志和调试

### 查看日志

在 Add-on 详情页面的 **日志** 标签页中，您可以看到：

- 设备 ID 信息
- 登录状态
- 代理注册结果
- FRPC 连接状态
- 错误信息（如果有）

### 调试级别

默认情况下，日志会显示关键的运行信息。如果遇到问题，可以：

1. 查看完整日志输出
2. 检查是否有错误或警告信息
3. 记录错误信息以便排查

## 故障排除

### 登录失败

如果提示账号或密码错误：

1. 确认邮箱和密码填写正确
2. 检查账号是否已在 LinknLink 平台开通
3. 联系管理员确认账号状态

> **常见错误**
> 
> - **账号不存在（status: -46009）**: 表示该邮箱未在平台注册，请使用LinknLink APP注册账号
> - **密码错误**: 请检查密码是否正确（注意大小写）

### 连接失败

如果 FRPC 无法建立连接：

1. 检查网络连接是否正常
2. 确认可以访问 `euhome.linklinkiot.com`
3. 查看日志中的详细错误信息
4. 尝试重启 Add-on

### 代理注册失败

如果代理注册返回错误：

1. 确认登录成功（检查日志中的User ID）
2. 查看完整的错误响应信息
3. 联系技术支持


## 高级功能

### 安全性

本 Add-on 在安全性方面的考虑：

1. **密码加密**: 登录时密码使用 SHA1 + Salt 加密传输
2. **HTTPS 连接**: 所有 API 调用均使用 HTTPS 加密
3. **密文存储**: 密码在配置界面以密文形式显示
4. **安全传输**: FRPC 连接使用加密隧道

## 更新日志

### v1.0.0

- 首次发布
- 支持 LinknLink 平台自动登录和注册
- 自动配置 Home Assistant 反向代理

## 技术支持

如果您遇到问题：

1. 查看本文档的故障排除部分
2. 检查日志中的详细错误信息
3. 在 [GitHub Issues](https://github.com/acmen0102/linknlink-remote/issues) 提交问题
4. 联系 LinknLink 平台技术支持

---

## 致谢

- [FRP 项目](https://github.com/fatedier/frp) - 提供反向代理核心功能
- LinknLink IoT 平台 - 提供设备管理和代理服务
- Home Assistant 社区 - 提供 Add-on 开发框架和支持

